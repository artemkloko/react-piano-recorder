(window.webpackJsonp=window.webpackJsonp||[]).push([[0],{161:function(t,e,n){"use strict";n.r(e);var r,a,o=n(0),i=n.n(o),c=n(23),s=n.n(c),u=n(82),l=n(31),d=(n(88),n(89),n(9)),p=n(16),m=n(11),f=n(10),v=n(12),h=n(24),g=n(20),y=(n(90),function(t){function e(t){var n;return Object(d.a)(this,e),(n=Object(m.a)(this,Object(f.a)(e).call(this,t))).addMidiIn=function(t){return function(e){var r=e.isLoading,a=e.playNote,o=e.stopNote,i=e.stopAllNotes;n.setState(function(e){return{receivers:Object(g.a)({},e.receivers,Object(h.a)({},t,{isLoading:r,playNote:a,stopNote:o,stopAllNotes:i}))}})}},n.addMidiOut=function(t){return{isLoading:!1,playNote:n.handleNotePress(t),stopNote:n.handleNoteRelease(t),stopAllNotes:n.handleStopAllNotes(t)}},n.handleNotePress=function(t){return function(e){var r=!0,a=!1,o=void 0;try{for(var i,c=t[Symbol.iterator]();!(r=(i=c.next()).done);r=!0){var s=i.value;n.state.receivers[s]&&n.state.receivers[s].playNote(e)}}catch(u){a=!0,o=u}finally{try{r||null==c.return||c.return()}finally{if(a)throw o}}}},n.handleNoteRelease=function(t){return function(e){var r=!0,a=!1,o=void 0;try{for(var i,c=t[Symbol.iterator]();!(r=(i=c.next()).done);r=!0){var s=i.value;n.state.receivers[s]&&n.state.receivers[s].stopNote(e)}}catch(u){a=!0,o=u}finally{try{r||null==c.return||c.return()}finally{if(a)throw o}}}},n.handleStopAllNotes=function(t){return function(){var e=!0,r=!1,a=void 0;try{for(var o,i=t[Symbol.iterator]();!(e=(o=i.next()).done);e=!0){var c=o.value;n.state.receivers[c]&&n.state.receivers[c].stopAllNotes()}}catch(s){r=!0,a=s}finally{try{e||null==i.return||i.return()}finally{if(r)throw a}}}},n.state={receivers:{},senders:{}},n}return Object(v.a)(e,t),Object(p.a)(e,[{key:"render",value:function(){return this.props.render({addMidiIn:this.addMidiIn,addMidiOut:this.addMidiOut})}}]),e}(i.a.Component)),b=n(18),O=n.n(b),N=n(29),j=n(76),E=n.n(j);!function(t){t[t.mp3=0]="mp3",t[t.ogg=1]="ogg"}(r||(r={})),function(t){t[t.MusyngKite=0]="MusyngKite",t[t.FluidR3_GM=1]="FluidR3_GM"}(a||(a={}));var C=function(t){function e(t){var n;return Object(d.a)(this,e),(n=Object(m.a)(this,Object(f.a)(e).call(this,t))).loadInstrument=function(){var t=Object(N.a)(O.a.mark(function t(e){var r;return O.a.wrap(function(t){for(;;)switch(t.prev=t.next){case 0:return n.setState({instrument:null}),t.next=3,E.a.instrument(n.props.audioContext,e,{format:n.props.format,soundfont:n.props.soundfont,nameToUrl:function(t,e,r){return"".concat(n.props.hostname,"/").concat(e,"/").concat(t,"-").concat(r,".js")}});case 3:r=t.sent,n.setState({instrument:r});case 5:case"end":return t.stop()}},t)}));return function(e){return t.apply(this,arguments)}}(),n.playNote=function(){var t=Object(N.a)(O.a.mark(function t(e){var r;return O.a.wrap(function(t){for(;;)switch(t.prev=t.next){case 0:return t.next=2,n.props.audioContext.resume();case 2:null!==n.state.instrument&&(r=n.state.instrument.play(e),n.setState({activeAudioNodes:Object.assign({},n.state.activeAudioNodes,Object(h.a)({},e,r))}));case 3:case"end":return t.stop()}},t)}));return function(e){return t.apply(this,arguments)}}(),n.stopNote=function(){var t=Object(N.a)(O.a.mark(function t(e){return O.a.wrap(function(t){for(;;)switch(t.prev=t.next){case 0:return t.next=2,n.props.audioContext.resume();case 2:if(n.state.activeAudioNodes[e]){t.next=4;break}return t.abrupt("return");case 4:n.state.activeAudioNodes[e].stop(),n.setState({activeAudioNodes:Object.assign({},n.state.activeAudioNodes,Object(h.a)({},e,null))});case 7:case"end":return t.stop()}},t)}));return function(e){return t.apply(this,arguments)}}(),n.stopAllNotes=Object(N.a)(O.a.mark(function t(){return O.a.wrap(function(t){for(;;)switch(t.prev=t.next){case 0:return t.next=2,n.props.audioContext.resume();case 2:Object.values(n.state.activeAudioNodes).forEach(function(t){t&&t.stop()}),n.setState({activeAudioNodes:{}});case 5:case"end":return t.stop()}},t)})),n.state={activeAudioNodes:{},instrument:null},n}return Object(v.a)(e,t),Object(p.a)(e,[{key:"componentDidMount",value:function(){var t=Object(N.a)(O.a.mark(function t(){return O.a.wrap(function(t){for(;;)switch(t.prev=t.next){case 0:return t.next=2,this.loadInstrument(this.props.instrumentName);case 2:this.props.midiIn({isLoading:!this.state.instrument,playNote:this.playNote,stopNote:this.stopNote,stopAllNotes:this.stopAllNotes});case 3:case"end":return t.stop()}},t,this)}));return function(){return t.apply(this,arguments)}}()},{key:"componentDidUpdate",value:function(t,e){t.instrumentName!==this.props.instrumentName&&this.loadInstrument(this.props.instrumentName)}},{key:"render",value:function(){return i.a.createElement("div",null)}}]),e}(i.a.Component);C.defaultProps={format:"mp3",soundfont:"MusyngKite",instrumentName:"acoustic_grand_piano",hostname:"https://d1pzp51pvbm36p.cloudfront.net"};var S=C,R=n(28),w=n(32),k=n(25),A=n.n(k),x=n(77),P=n.n(x),T=function(t){var e=Math.floor(t/60),n=t%60;return"".concat(e<10?0:"").concat(e,":").concat(n<10?0:"").concat(n.toFixed(3))},I=function(t){function e(t){var n;return Object(d.a)(this,e),(n=Object(m.a)(this,Object(f.a)(e).call(this,t))).componentDidMount=function(){n.props.midiIn({isLoading:!1,playNote:n.playNote,stopNote:n.stopNote,stopAllNotes:n.stopAllNotes})},n.componentWillUnmount=function(){clearInterval(n.state.clock)},n.displayRecordingDuration=function(){n.state.isRecording&&n.setState({displayDuration:n.props.audioContext.currentTime-n.state.start})},n.playNote=function(t){n.setState(function(e){return{stillPressed:Object(g.a)({},e.stillPressed,Object(h.a)({},t,{note:t,absoluteTime:n.props.audioContext.currentTime}))}})},n.stopNote=function(t){n.setState(function(e){var r=e.isRecording,a=e.start,o=e.stillPressed,i=e.recording,c=n.props.audioContext.currentTime;return r&&null!==i&&(i=Object(g.a)({},i,{events:[].concat(Object(R.a)(i.events),[n.midiPressEventToMidiEvent(o[t],c,a)])})),delete o[t],{stillPressed:o,recording:i}})},n.stopAllNotes=function(){n.setState(function(t){var e=Object(g.a)({},t),r=e.start,a=e.stillPressed,o=e.recording,i=n.props.audioContext.currentTime,c=Object.keys(a).map(function(t){return n.midiPressEventToMidiEvent(a[t],i,r)});return null!==o&&(o=Object(g.a)({},o,{events:[].concat(Object(R.a)(o.events),Object(R.a)(c))})),{recording:o}})},n.midiPressEventToMidiEvent=function(t,e,n){var r=t.absoluteTime>=n?t.absoluteTime-n:0,a=e-n-r;return{note:t.note,time:r,duration:a}},n.startRecording=function(){n.setState({isRecording:!0,start:n.props.audioContext.currentTime,recording:{createdAt:new Date,events:[]}})},n.stopRecording=function(){n.stopAllNotes(),n.setState(function(t){var e=Object(g.a)({},t),r=e.start,a=e.recording;return null!==a&&(a.duration=n.props.audioContext.currentTime-r,n.props.onStopRecording&&n.props.onStopRecording(a)),{isRecording:!1,displayDuration:0,recording:a}})},n.state={isRecording:!1,start:0,displayDuration:0,stillPressed:{},recording:null,clock:setInterval(n.displayRecordingDuration,100)},n}return Object(v.a)(e,t),Object(p.a)(e,[{key:"render",value:function(){return i.a.createElement("div",null,i.a.createElement(P.a,null,i.a.createElement("h1",null,!1===this.state.isRecording?i.a.createElement(A.a,{variant:"primary",size:"lg",onClick:this.startRecording},i.a.createElement(w.a,null)):i.a.createElement(A.a,{variant:"primary",size:"lg",onClick:this.stopRecording},i.a.createElement(w.c,null))," "+T(this.state.displayDuration)),i.a.createElement("p",null,"Just hit the record button and let the magic happen.",i.a.createElement("br",null),"You can resample your recordings by playing them while recoding.")))}}]),e}(i.a.Component),M=n(33),D={first:M.b.fromNote("c3"),last:M.b.fromNote("f4")},L=M.a.create({firstNote:D.first,lastNote:D.last,keyboardConfig:M.a.HOME_ROW}),_=function(t){function e(t){var n;return Object(d.a)(this,e),(n=Object(m.a)(this,Object(f.a)(e).call(this,t))).playNote=function(t){n.setState(function(e){return{activeNotes:[].concat(Object(R.a)(e.activeNotes),[t])}})},n.stopNote=function(t){n.setState(function(e){return{activeNotes:e.activeNotes.filter(function(e){return e!==t})}})},n.stopAllNotes=function(){n.setState(function(t){return{activeNotes:[]}})},n.state={activeNotes:[]},n}return Object(v.a)(e,t),Object(p.a)(e,[{key:"componentDidMount",value:function(){var t=Object(N.a)(O.a.mark(function t(){return O.a.wrap(function(t){for(;;)switch(t.prev=t.next){case 0:this.props.midiIn({isLoading:!1,playNote:this.playNote,stopNote:this.stopNote,stopAllNotes:this.stopAllNotes});case 1:case"end":return t.stop()}},t,this)}));return function(){return t.apply(this,arguments)}}()},{key:"render",value:function(){return i.a.createElement(M.c,{disabled:!1,noteRange:D,playNote:this.props.midiOut.playNote,stopNote:this.props.midiOut.stopNote,width:1e3,keyboardShortcuts:L,activeNotes:this.state.activeNotes})}}]),e}(i.a.Component),z=function(t){function e(t){var n;return Object(d.a)(this,e),(n=Object(m.a)(this,Object(f.a)(e).call(this,t))).componentWillUnmount=function(){clearInterval(n.state.clock)},n.checkSchedule=function(){if(!1!==n.state.isPlaying){var t=n.props.audioContext.currentTime;n.setState(function(e){var n=e.schedule;for(e.isPlaying;n.length>0&&n[0].absoluteTime<t;){var r=n.shift();r&&r.action(r.note)}return{isPlaying:n.length>0,schedule:n}})}},n.play=function(t){n.props.midiOut.stopAllNotes();var e=n.props.audioContext.currentTime,r=t.reduce(function(t,r){return t.push({note:r.note,absoluteTime:e+r.time,action:n.props.midiOut.playNote}),t.push({note:r.note,absoluteTime:e+r.time+r.duration,action:n.props.midiOut.stopNote}),t},[]).sort(function(t,e){return t.absoluteTime-e.absoluteTime});n.setState({isPlaying:!0,schedule:r})},n.stop=function(){n.props.midiOut.stopAllNotes(),n.setState({isPlaying:!1,schedule:[]})},n.state={isPlaying:!1,schedule:[],clock:setInterval(n.checkSchedule,2)},n}return Object(v.a)(e,t),Object(p.a)(e,[{key:"render",value:function(){return this.props.render({play:this.play,stop:this.stop,isPlaying:this.state.isPlaying})}}]),e}(i.a.Component),F=n(45),G=n.n(F),U=n(44),J=n.n(U),K=n(37),W=n.n(K),q=(n(111),n(55)),B=n(35),H=n.n(B);function $(){var t=Object(q.a)(["\n  mutation AddRecordingMutation($recording: InputRecording) {\n    addRecording(recording: $recording) {\n      createdAt\n      events {\n        note\n        time\n        duration\n      }\n      duration\n      title\n    }\n  }\n"]);return $=function(){return t},t}function Q(){var t=Object(q.a)(["\n  query GetRecordingsQuery {\n    recordings {\n      _id\n      createdAt\n      events {\n        note\n        time\n        duration\n      }\n      duration\n      title\n    }\n  }\n"]);return Q=function(){return t},t}var Y=H()(Q()),V=H()($()),X=function(t){function e(t){var n;return Object(d.a)(this,e),(n=Object(m.a)(this,Object(f.a)(e).call(this,t))).setTitle=function(t){"string"===typeof t.currentTarget.value&&n.setState({title:t.currentTarget.value})},n.cancel=function(){n.props.onCancel()},n.save=function(){var t=Object(g.a)({},n.props.recording,{title:n.state.title});n.props.onConfirm(t)},n.state={title:n.props.recording.title||""},n}return Object(v.a)(e,t),Object(p.a)(e,[{key:"render",value:function(){return i.a.createElement(J.a,{show:!0,onHide:this.cancel},i.a.createElement(W.a,{onSubmit:this.save},i.a.createElement(J.a.Body,null,i.a.createElement(W.a.Group,{controlId:"title"},i.a.createElement(W.a.Label,null,"Recording title"),i.a.createElement(W.a.Control,{type:"text",placeholder:"Enter a title for your recording",value:this.state.title,onChange:this.setTitle}))),i.a.createElement(J.a.Footer,null,i.a.createElement(A.a,{variant:"secondary",onClick:this.cancel},"Cancel"),i.a.createElement(A.a,{variant:"primary",onClick:this.save},"Save"))))}}]),e}(i.a.Component),Z=function(t){return i.a.createElement(l.b,{mutation:V},function(e,n){return n.data,i.a.createElement(X,Object.assign({},t,{onConfirm:function(n){e({variables:{recording:n}}),t.onConfirm(n)}}))})},tt=function(t){function e(){var t,n;Object(d.a)(this,e);for(var r=arguments.length,a=new Array(r),o=0;o<r;o++)a[o]=arguments[o];return(n=Object(m.a)(this,(t=Object(f.a)(e)).call.apply(t,[this].concat(a)))).play=function(){n.props.play(n.props.recording)},n.render=function(){return i.a.createElement("span",null,!1===n.props.isPlaying?i.a.createElement(A.a,{variant:"primary",size:"sm",onClick:n.play},i.a.createElement(w.b,null)):i.a.createElement(A.a,{variant:"primary",size:"sm",onClick:n.props.stop},i.a.createElement(w.c,null))," "+n.props.recording.title,n.props.recording.duration&&" - "+T(n.props.recording.duration),i.a.createElement("span",{style:{float:"right"}},n.props.recording.createdAt.toLocaleString()))},n}return Object(v.a)(e,t),e}(i.a.Component),et=function(t){function e(t){var n;return Object(d.a)(this,e),(n=Object(m.a)(this,Object(f.a)(e).call(this,t))).play=function(t){n.props.onPlay(t.events),n.setState({currentlyPlaying:t})},n.stop=function(){n.props.onStop(),n.setState({currentlyPlaying:null})},n.addRecording=function(t){n.setState({newRecording:t})},n.saveRecording=function(t){n.setState({recordings:[].concat(Object(R.a)(n.state.recordings),[t]),newRecording:null})},n.cancelSaving=function(){n.setState({newRecording:null})},n.state={recordings:t.recordings||[],currentlyPlaying:null,newRecording:null},n}return Object(v.a)(e,t),Object(p.a)(e,[{key:"render",value:function(){var t=this,e=this.state.recordings.map(function(e,n){return i.a.createElement(G.a.Item,null,i.a.createElement(tt,{key:n,recording:e,play:t.play,stop:t.stop,isPlaying:t.state.currentlyPlaying===e&&t.props.isPlaying}))});return i.a.createElement("div",null,this.props.render({addRecording:this.addRecording}),i.a.createElement(G.a,null,e.length>0?e:i.a.createElement(G.a.Item,null,"No recordings yet...")),null!==this.state.newRecording&&i.a.createElement(Z,{recording:this.state.newRecording,onConfirm:this.saveRecording,onCancel:this.cancelSaving}))}}]),e}(i.a.Component),nt=function(t){return i.a.createElement(l.c,{query:Y},function(e){var n=e.loading,r=e.error,a=e.data;return n?"Loading...":r?"Error! ".concat(r.message):(a&&a.recordings&&(t.recordings=a.recordings),i.a.createElement(et,t))})},rt=new(window.AudioContext||window.webkitAudioContext),at=function(t){function e(){return Object(d.a)(this,e),Object(m.a)(this,Object(f.a)(e).apply(this,arguments))}return Object(v.a)(e,t),Object(p.a)(e,[{key:"render",value:function(){return i.a.createElement(y,{render:function(t){var e=t.addMidiIn,n=t.addMidiOut;return i.a.createElement("div",null,i.a.createElement(S,{instrumentName:"acoustic_grand_piano",audioContext:rt,midiIn:e("soundfont")}),i.a.createElement(_,{midiIn:e("piano"),midiOut:n(["soundfont","recorder"])}),i.a.createElement(z,{audioContext:rt,midiOut:n(["piano"]),render:function(t){var n=t.play,r=t.stop,a=t.isPlaying;return i.a.createElement(nt,{onPlay:n,onStop:r,isPlaying:a,render:function(t){var n=t.addRecording;return i.a.createElement(I,{audioContext:rt,midiIn:e("recorder"),onStopRecording:n})}})}}))}})}}]),e}(i.a.Component);var ot=function(){return i.a.createElement("div",{className:"App"},i.a.createElement("h1",null,"React Piano Recorder"),i.a.createElement(at,null))},it=new u.a({uri:"http://localhost:4000"});s.a.render(i.a.createElement(l.a,{client:it},i.a.createElement(ot,null)),document.getElementById("root"))},83:function(t,e,n){t.exports=n(161)},88:function(t,e,n){},89:function(t,e,n){}},[[83,1,2]]]);
//# sourceMappingURL=main.f2494b70.chunk.js.map